(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("THREEx"),require("THREE"),require("vue"),require("Desc")):"function"===typeof define&&define.amd?define(["THREEx","THREE",,"Desc"],t):"object"===typeof exports?exports["cbkzxtArBasic"]=t(require("THREEx"),require("THREE"),require("vue"),require("Desc")):e["cbkzxtArBasic"]=t(e["THREEx"],e["THREE"],e["Vue"],e["Desc"])})("undefined"!==typeof self?self:this,(function(e,t,i,n){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="fae3")}({"1ac3":function(t,i){t.exports=e},"5fda":function(e,i){e.exports=t},"8bbf":function(e,t){e.exports=i},d182:function(e,t){e.exports=n},faa1:function(e,t,i){"use strict";var n,r="object"===typeof Reflect?Reflect:null,s=r&&"function"===typeof r.apply?r.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};function o(e){console&&console.warn&&console.warn(e)}n=r&&"function"===typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!==e};function h(){h.init.call(this)}e.exports=h,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var c=10;function l(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?h.defaultMaxListeners:e._maxListeners}function d(e,t,i,n){var r,s,a;if(l(i),s=e._events,void 0===s?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),a=s[t]),void 0===a)a=s[t]=i,++e._eventsCount;else if("function"===typeof a?a=s[t]=n?[i,a]:[a,i]:n?a.unshift(i):a.push(i),r=u(e),r>0&&a.length>r&&!a.warned){a.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=e,h.type=t,h.count=a.length,o(h)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(e,t,i){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},r=f.bind(n);return r.listener=i,n.wrapFn=r,r}function m(e,t,i){var n=e._events;if(void 0===n)return[];var r=n[t];return void 0===r?[]:"function"===typeof r?i?[r.listener||r]:[r]:i?y(r):w(r,r.length)}function g(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"===typeof i)return 1;if(void 0!==i)return i.length}return 0}function w(e,t){for(var i=new Array(t),n=0;n<t;++n)i[n]=e[n];return i}function v(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function y(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),h.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},h.prototype.getMaxListeners=function(){return u(this)},h.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var n="error"===e,r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var h=r[e];if(void 0===h)return!1;if("function"===typeof h)s(h,this,t);else{var c=h.length,l=w(h,c);for(i=0;i<c;++i)s(l[i],this,t)}return!0},h.prototype.addListener=function(e,t){return d(this,e,t,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(e,t){return d(this,e,t,!0)},h.prototype.once=function(e,t){return l(t),this.on(e,p(this,e,t)),this},h.prototype.prependOnceListener=function(e,t){return l(t),this.prependListener(e,p(this,e,t)),this},h.prototype.removeListener=function(e,t){var i,n,r,s,o;if(l(t),n=this._events,void 0===n)return this;if(i=n[e],void 0===i)return this;if(i===t||i.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!==typeof i){for(r=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){o=i[s].listener,r=s;break}if(r<0)return this;0===r?i.shift():v(i,r),1===i.length&&(n[e]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",e,o||t)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(e){var t,i,n;if(i=this._events,void 0===i)return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var r,s=Object.keys(i);for(n=0;n<s.length;++n)r=s[n],"removeListener"!==r&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],"function"===typeof t)this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},h.prototype.listeners=function(e){return m(this,e,!0)},h.prototype.rawListeners=function(e){return m(this,e,!1)},h.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},h.prototype.listenerCount=g,h.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]}},fae3:function(e,t,i){"use strict";if(i.r(t),i.d(t,"ModelViewer",(function(){return pt})),i.d(t,"toRad",(function(){return V})),i.d(t,"toRads",(function(){return F})),i.d(t,"toDegree",(function(){return z})),i.d(t,"toDegrees",(function(){return U})),i.d(t,"lerp",(function(){return H})),i.d(t,"rlerp",(function(){return q})),i.d(t,"circleOut",(function(){return Y})),i.d(t,"powerOut",(function(){return X})),i.d(t,"stick",(function(){return $})),i.d(t,"distance",(function(){return G})),i.d(t,"toZero",(function(){return W})),i.d(t,"newEaseFunc",(function(){return K})),i.d(t,"toVec3",(function(){return J})),i.d(t,"toXYZ",(function(){return Z})),i.d(t,"meshesFromDescs",(function(){return ue})),i.d(t,"meshFromDesc",(function(){return de})),i.d(t,"isMesh",(function(){return fe})),i.d(t,"mapModels",(function(){return pe})),i.d(t,"importGLTF",(function(){return me})),i.d(t,"removeUndefProp",(function(){return v})),i.d(t,"assignWhenExist",(function(){return y})),i.d(t,"eachChild",(function(){return _})),i.d(t,"mapFindIndex",(function(){return b})),i.d(t,"mapFind",(function(){return S})),i.d(t,"tryAwait",(function(){return mt})),i.d(t,"sleep",(function(){return gt})),i.d(t,"numsToStr",(function(){return wt})),i.d(t,"yyyymmdd",(function(){return vt})),i.d(t,"hhmmss",(function(){return yt})),i.d(t,"ArExpScene",(function(){return oe})),i.d(t,"ArModelScene",(function(){return Se})),i.d(t,"ArRender",(function(){return Le})),i.d(t,"ArScene",(function(){return re})),i.d(t,"ArSceneMgr",(function(){return Ce})),i.d(t,"ArSceneType",(function(){return a})),i.d(t,"ArVideoScene",(function(){return Ee})),i.d(t,"FileMgr",(function(){return A})),i.d(t,"HashInfo",(function(){return g})),i.d(t,"HashInfoDiff",(function(){return M})),i.d(t,"HashInfoDiffTypes",(function(){return w})),i.d(t,"IDBFS",(function(){return B})),i.d(t,"IDBFSFile",(function(){return T})),i.d(t,"IDBFSMergeStep",(function(){return R})),i.d(t,"IndexedDB",(function(){return u})),i.d(t,"IndexFile",(function(){return f})),i.d(t,"Loader",(function(){return Oe})),i.d(t,"MarkerMgr",(function(){return P})),i.d(t,"MatMgr",(function(){return le})),i.d(t,"ModelMgr",(function(){return ve})),i.d(t,"ModelRender",(function(){return Ne})),i.d(t,"NumberRange",(function(){return ee})),i.d(t,"OrbitController",(function(){return Ie})),i.d(t,"OrbitValue",(function(){return _e})),i.d(t,"ProcessEvent",(function(){return D})),i.d(t,"RangeDesc",(function(){return ie})),i.d(t,"ResourceMgr",(function(){return c})),i.d(t,"TexMgr",(function(){return he})),"undefined"!==typeof window){var n=window.document.currentScript,r=n&&n.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);r&&(i.p=r[1])}i("d182");var s,o=i("5fda");(function(e){e[e["none"]=0]="none",e[e["video"]=1]="video",e[e["model"]=2]="model",e[e["exp"]=3]="exp"})(s||(s={}));var a=s;class h extends Map{constructor(){super(...arguments),this.unready=new Set}get count(){return this.size+this.unready.size}emitProgress(e,t){this.processCB&&this.processCB(e,t,this)}regBasicRes(...e){}async initBasicRes(){}async init(){this.regBasicRes(),await this.initBasicRes();let e=this.unready.size,t=0;this.emitProgress(t,e);for(let i of this.unready)await this.make(i),this.unready.delete(i),this.emitProgress(t+=1,e)}reg(e){this.has(e)||this.unready.has(e)||this.unready.add(e)}}var c=h;class l{constructor(e){this.idb=e}static createFromTables(e,t){for(let[i,n]of t)if(!e.objectStoreNames.contains(i)){let t=e.createObjectStore(i,n.param);if(n.indexs)for(let e of n.indexs)t.createIndex(...e)}}static async open(e,t,i){return new Promise((function(n,r){let s=window.indexedDB.open(e,t);s.onsuccess=function(){n(new l(this.result))},s.onerror=r,s.onupgradeneeded=function(e){i(this,e)}}))}getTable(e,t=!1){return this.idb.transaction(e,t?"readonly":"readwrite").objectStore(e)}static async reqToPromise(e){return new Promise((function(t,i){e.onerror=i,e.onsuccess=function(){t(this.result)}}))}async add(e,t){return l.reqToPromise(this.getTable(e).add(t))}async put(e,t){return l.reqToPromise(this.getTable(e).put(t))}async findKey(e,t,i){return l.reqToPromise(i?this.getTable(e).index(i).getKey(t):this.getTable(e).getKey(t))}async findKeys(e,t,i){return i?l.reqToPromise(this.getTable(e).index(i).getAllKeys(t)):await this.has(e,t)?[t]:[]}async del(e,t,i){let n=await this.findKey(e,t,i);if(void 0!==n)return await l.reqToPromise(this.getTable(e).delete(n)),n}static dataToKey(e,t){let{keyPath:i}=e;return"string"===typeof i?t[i]:i.map(e=>t[e])}async has(e,t,i){return void 0!==await this.findKey(e,t,i)}async get(e,t,i){let n=await this.findKey(e,t,i);return n&&await l.reqToPromise(this.getTable(e).get(n))}async*items(e){"string"===typeof e&&(e=this.getTable(e));let t,i=await l.reqToPromise(e.count()),n=e.openCursor(),r=0;while(t=await l.reqToPromise(n))yield[t.value,t.key,r,i],r+=1,t.continue()}}var u=l;class d{constructor(e){this.version="",this.versionName="",this.generatorName="HELPER",this.splitBar="-".repeat(70),this.lineSeparator="\n",this.columnseparator="\t",this.datas=[],e&&(this.text=e)}get dataText(){return this.datas.map(e=>e.join(this.columnseparator)).join(this.lineSeparator)}set dataText(e){this.parseData(e.split(this.lineSeparator))}parseData(e){this.cleanData(),this.datas=e.map(e=>e.split(this.columnseparator))}get headerText(){return["",`THIS FILE IS GENERATED BY ${this.generatorName}, DON'T CHANGE IT MANUALLY!`,"",[this.version,this.versionName].join(this.columnseparator)].join(this.lineSeparator)}set headerText(e){this.parseHeader(e.split(this.lineSeparator))}parseHeader(e){if(this.generatorName=e[1].substring(26,e[1].length-27),[this.version,this.versionName]=e[3].split(this.columnseparator),this.headerText!==e.join(this.lineSeparator))throw"Error IndexFile Header!"}get text(){let e=this.headerText+this.lineSeparator+this.splitBar;return this.datas.length&&(e+=this.lineSeparator+this.dataText),e+this.lineSeparator}set text(e){this.parseText(e.replace(/\r\n/g,"\n").split(this.lineSeparator))}parseText(e){this.parseHeader(e.slice(0,4)),this.parseData(e.slice(5,-1))}addData(...e){this.datas.push(e)}cleanData(){this.datas=[]}}var f=d;class p{constructor(e,t){this.hash=e,this.info=t}infoEqualFunc(e){return this.info===e}infoEqual(e){return this.infoEqualFunc(e.info)}static toMap(e){let t=new Map;for(let i of e)t.set(i.hash,i.info);return t}static fromMap(e){let t=[];for(let[i,n]of e)t.push(new p(i,n));return t}}var m,g=p;(function(e){e[e["Add"]=0]="Add",e[e["Delete"]=1]="Delete",e[e["ReHash"]=2]="ReHash",e[e["ReInfo"]=3]="ReInfo"})(m||(m={}));var w=m;function v(e){for(let t of Object.keys(e))void 0===e[t]&&delete e[t];return e}function y(e,t){return Object.assign(e,v(t))}function _(e,t,i){for(let n of t)n.children&&_(e,n.children,n),e(n,i)}function b(e,t,i=((e,t)=>e===t)){for(let[n,r]of e)if(i(r,t))return n}function S(e,t,i=((e,t)=>e===t)){for(let[,n]of e)if(i(n,t))return n}class x{constructor(e,t,i){this.left=t,this.right=i,this.type=e}static toMap(e){return new Map(e.map(e=>[e.hash,e]))}static compare(e,t){let i=[],n=x.toMap(e),r=x.toMap(t),s=[];for(let[o,a]of r){let e=n.get(o);e&&(e.infoEqual(a)||s.push(new x(w.ReInfo,e,a)),n.delete(o),r.delete(o))}for(let[,o]of n){let e=S(r,o,(e,t)=>e.infoEqual(t));e?(i.push(new x(w.ReHash,o,e)),r.delete(e.hash)):i.push(new x(w.Delete,o))}for(let[,o]of r)i.push(new x(w.Add,void 0,o));return i.concat(s)}}var M=x;class L{constructor(){this.hashDelete=[],this.hashAdd=[],this.fileDelete=[],this.fileAdd=[]}get length(){return this.hashDelete.length+this.hashAdd.length+this.fileDelete.length+this.fileAdd.length}}var R=L;class E extends g{constructor(e,...t){super(e,t)}infoEqualFunc(e){if(this.info.length!==e.length)return!1;this.info.sort(),e.sort();for(let t=0;t<e.length;t+=1)if(this.info[t]!==e[t])return!1;return!0}static fromIndex(e){let t=new Map;for(let[n,r]of e.datas)t.has(n)||t.set(n,[]),t.get(n).push(r);let i=[];for(let[n,r]of t.entries())i.push(new E(n,...r));return i}static calcMergeSteps(e,t){let i=M.compare(e,t),n=new R,r=e=>{let{hash:t,info:i}=e.right;n.hashAdd.push({hash:t,url:i[0]}),n.fileAdd.push(...i.map(e=>({hash:t,url:e})))},s=e=>{let{hash:t,info:i}=e.left;n.hashDelete.push(t),n.fileDelete.push(...i)};for(let o of i)switch(o.type){case w.Add:r(o);break;case w.Delete:s(o);break;case w.ReInfo:let e=new Set(o.left.info),t=new Set(o.right.info);for(let n of e)t.has(n)&&(e.delete(n),t.delete(n));n.fileDelete.push(...e);let{hash:i}=o.left;for(let r of t)n.fileAdd.push({hash:i,url:r});break;case w.ReHash:s(o),r(o)}return n}}var T=E;let C=(()=>{class e extends ProgressEvent{constructor(t,i,n=0,r=1,s=!0){super(t,{total:r,loaded:n,lengthComputable:s}),this.msg="",this.info=i;let o=e.msgs.get(t);this.msgTemplete=o,o&&(this.msg=o(this))}static newError(t,i,n=0,r=1){return new e(t,i,n,r,!1)}}return e.msgs=new Map([["IDBFS.Merge",e=>`正在${e.info.action}资源：${e.info.content}`],["Loader.IndexGetting",()=>"正在下载资源列表…"],["Loader.IndexFetchError",e=>"下载资源列表失败："+e.info],["Loader.IndexLocal",e=>"使用本地资源版本："+e.info.versionName],["Loader.IndexNone",()=>"本地资源库尚未初始化完成，请联网后重试！"],["Loader.IndexDiffsCalcing",()=>"正在比对资源差异…"],["Loader.IndexNewest",e=>"资源已是最新版本："+e.info.versionName],["Loader.ScenesReging",()=>"正在注册场景信息…"],["Loader.ScenesReged",()=>"场景信息注册完成"],["Loader.ModelsLoading",()=>"正在加载模型…"],["Loader.ScenesLoading",()=>"正在加载场景…"],["Loader.ScenesLoaded",()=>"场景加载完成"],["Loader.ArIniting",()=>"正在初始化AR环境…"],["Loader.ArInited",()=>"AR环境初始化完成"],["ArRender.ArStarting",()=>"正在启动AR…"],["Loader.ArStarted",()=>"AR启动成功"]]),e})();var D=C;let O=(()=>{class e{constructor(){this._initing=!1,this.blobUrlMap=new Map,this.urlBlobMap=new Map,this.files=new Set,this.init()}get initing(){return this._initing}get version(){return this._version||""}get versionName(){return this._versionName||""}setVersion(e,t){this._version=e,this._versionName=t}async updateVersion(e,t){await this.db.put("sets",{set_id:"version",version:e,versionName:t}),this.setVersion(e,t)}async init(){if(this.db)return;if(this._initing)return new Promise(e=>{this.waiter||(this.waiter=[]),this.waiter.push(e)});this._initing=!0,this.db=await u.open("IDBFS",1,(function(e){u.createFromTables(e.result,new Map([["caches",{param:{keyPath:"hash"}}],["files",{param:{keyPath:"url"},indexs:[["hashIndex","hash",{unique:!1}]]}],["sets",{param:{keyPath:"set_id"}}]]))})),await this.updateFiles();let e=await this.db.get("sets","version");e&&this.setVersion(e.version,e.versionName),this.waiter&&this.waiter.forEach(e=>e()),this._initing=!1}get inited(){return new Boolean(this.db).valueOf()}async updateFiles(){this.files.clear();let e=[];for await(let[{url:t}]of this.db.items("files"))e.push(t);e.sort().forEach(this.files.add,this.files)}static async fetchBlob(t,i){return"string"!==typeof t||t.startsWith("http")||(t=e.resServer+(t.startsWith("/")?t:"/"+t)),(await fetch(t,i)).blob()}async regUrl(e,t,i){return i?this.db.put("files",{url:e,hash:t}):this.db.add("files",{url:e,hash:t})}async regBlob(e,t){return await this.init(),this.db.put("caches",{hash:e,blob:t})}async hashToBlob(e){return(await this.db.get("caches",e)).blob}async hashToUrl(e){return this.db.findKeys("files",e,"hashIndex")}async urlToHash(e){return(await this.db.get("files",e)).hash}async urlToBlob(e){let t=await this.urlToHash(e);if(t)return this.hashToBlob(t)}async urlToBlobUrl(e){let t=await this.urlToBlob(e);return t&&this.blobUrl(t)}blobUrl(e){let t=this.blobUrlMap.get(e);return t||(t=URL.createObjectURL(e),this.blobUrlMap.set(e,t),this.urlBlobMap.set(t,e)),t}blobUrlToBlob(e){return this.urlBlobMap.get(e)}async hasUrl(e){return this.db.has("files",e)}async delHash(e,t){if(await this.db.del("caches",e),t)for(let i of await this.hashToUrl(e))await this.delUrl(i)}async delUrl(e,t){let i;t&&(i=await this.urlToHash(e)),await this.db.del("files",e),i&&!await this.db.has("files",i,"hashIndex")&&await this.delHash(i)}async rename(e,t,i=!1){let n=await this.urlToHash(e);if(!n)throw"Can't find url: "+n;await this.regUrl(t,n,i),await this.delUrl(e)}async cachedIndex(){let e=new f;e.version=this.version,e.versionName=this.versionName;for await(let[{hash:t,url:i}]of this.db.items("files"))e.addData(t,i);return e}async calcDiffs(e){if(this.version!==e.version)return T.calcMergeSteps(T.fromIndex(await this.cachedIndex()),T.fromIndex(e))}find(e){return[...this.files].filter(t=>e.test(t))}async mergeTo(t,i){let n=await this.calcDiffs(t);if(!n)return;let r=0,s=n.length,o=(e,t)=>i&&i(new D("IDBFS.Merge",{action:e,content:t},r+=1,s));for(let{hash:c,url:l}of n.hashAdd)await o("下载",l),await this.regBlob(c,await e.fetchBlob(l));for(let e of n.fileDelete)await o("解注册",e),await this.delUrl(e);for(let{hash:e,url:c}of n.fileAdd)await o("注册",c),await this.regUrl(c,e);for(let e of n.hashDelete)await o("删除",e),await this.delHash(e);await this.updateFiles();let{version:a,versionName:h}=t;await this.updateVersion(a,h)}}return e.resServer="",e.instance=new e,e})();var B=O;let N=(()=>{class e extends c{async make(t){let i=this.get(t);if(i)return i;let n=await e.fs.urlToBlob(t);if(!n)throw`Can't find file '${t}' in FS!`;this.set(t,n)}getBlobUrl(t){let i=this.get(t);return i&&e.fs.blobUrl(i)}}return e.fs=B.instance,e.instance=new e,e})();var A=N;let I=(()=>{class e extends c{constructor(){super(...arguments),this.fileMgr=A.instance}regBasicRes(...e){let t=e.length?e:this.unready;for(let i of t)this.fileMgr.reg(`markers/${i}.iset`),this.fileMgr.reg(`markers/${i}.fset`),this.fileMgr.reg(`markers/${i}.fset3`)}async initBasicRes(){await this.fileMgr.init()}async make(e,t){let i=this.get(e);if(i)return i;t||(this.regBasicRes(e),await this.initBasicRes());let n=this.fileMgr.getBlobUrl(`markers/${e}.iset`),r=this.fileMgr.getBlobUrl(`markers/${e}.fset`),s=this.fileMgr.getBlobUrl(`markers/${e}.fset3`);if(!n||!r||!s)throw"Error Marker: "+JSON.stringify(e);let o={iset:n,fset:r,fset3:s};return this.set(e,o),o}}return e.instance=new e,e})();var P=I,j=i("8bbf"),k=i.n(j);function V(e){return e/180*Math.PI}function F(...e){return e.map(e=>V(e))}function z(e){return 180*e/Math.PI}function U(...e){return e.map(e=>z(e))}function H(e,t,i){return(t-e)*i+e}function q(e,t,i){return(i-e)/(t-e)}function Y(e){return e<0&&(e=0),Math.sqrt(1-Math.pow(e-1,2))}function X(e,t=2){return e>1?1:1-Math.pow(1-e,t)}function $(e,t=0,i=50){let n=e-t;return Math.sign(n)*Math.log1p(Math.abs(n)/i)*i+t}function G(e,t,i,n){let r=i-e,s=n-t;return Math.sqrt(r*r+s*s)}function W(e,t){let i;return e>0?(i=e-t,i<0?0:i):(i=e+t,i>0?0:i)}function K(e=.2){let t=e*e/(1-e-e);if(t===1/0)return function(e){return e};let i=t+t*t;return function(e){return 1+t-i/(e+t)}}function J(e){return new o["Vector3"](...e)}function Z(e){return[e.x,e.y,e.z]}class Q{constructor(e=0,t=1){this.min=e,this.max=t}get distance(){return this.max-this.min}clamp(e){return e<this.min?this.min:e>this.max?this.max:e}contain(e){return e>=this.min&&e<=this.max}lerp(e){return H(this.min,this.max,e)}rlerp(e){return q(this.min,this.max,e)}}var ee=Q;class te extends ee{constructor(){super(...arguments),this.group=10,this.initValue=0,this.step=1,this.unit=""}fixValue(e){let t=Math.round((e-this.min)/this.step)*this.step+this.min;return this.clamp(t)}static create(e){let t=new te;return Object.assign(t,e),t}}var ie=te;class ne extends o["Scene"]{constructor(e){super(),this.sceneID="none",this.title="请扫描带有AR标识的图片",this.sceneType=a.none,this.camera=new o["Camera"],this.onTickFuncs=[],this.params=[],this.paramsValue=new k.a({data:{values:{}}}),this.visible=!1,this.marker=e,this.add(this.camera),this.camera.visible=!1}setWithDesc(e,t=P.instance){this.name=e.sceneID,e.markerUrl&&(this.marker=t.get(e.markerUrl));let{sceneID:i,title:n,params:r,desc:s,onTickFuncs:o}=e;if(r)for(let a of r)k.a.set(this.paramsValue.values,a.name,a.desc instanceof ie?a.desc.initValue:a.desc.cases.get(a.desc.default));y(this,{sceneID:i,title:n,params:r,desc:s,onTickFuncs:o})}getZoom(){return 1}static fromDesc(e){let t=new ne;return t.setWithDesc(e),t}}var re=ne;class se extends re{constructor(e){super(e),this.add(this.camera),this.sceneType=a.exp}static fromDesc(e,t=P.instance){let i=new se;return i.setWithDesc(e,t),i}}var oe=se;let ae=(()=>{class e extends c{constructor(){super(...arguments),this.fileMgr=A.instance}regBasicRes(...e){let t=e.length?e:this.unready;for(let i of t)i instanceof o["Texture"]||this.fileMgr.reg("string"===typeof i?i:i.url)}async initBasicRes(){await this.fileMgr.init()}async make(e,t){let i=this.get(e);if(i)return i;if(e instanceof o["Texture"])return this.set(e,e),e;let n,r="";if("string"===typeof e?r=e:(r=e.url,n=e.params),!r)throw"Empty Texture Url!";t||(this.regBasicRes(r),await this.initBasicRes());let s=this.fileMgr.getBlobUrl(r);if(!s)throw"Missed Tex File: "+r;let a=new o["TextureLoader"];return new Promise((t,i)=>a.load(s,i=>{n&&Object.assign(i,n),this.set(e,i),t(i)},void 0,i))}reg(e){e instanceof o["Texture"]?this.set(e,e):super.reg(e)}}return e.instance=new e,e})();var he=ae;let ce=(()=>{class e extends c{constructor(){super(...arguments),this.texMgr=he.instance}regBasicRes(...e){let t=e.length?e:this.unready;for(let i of t)if(!(i instanceof o["Material"])){if(!i.matClass&&!i.init)throw"Error MatDesc: "+JSON.stringify(i);if(i.params)for(let e of Object.getOwnPropertyNames(i.params))("map"===e||e.endsWith("Map"))&&this.texMgr.reg(i.params[e])}}async initBasicRes(){await this.texMgr.init()}async make(e,t){let i=this.get(e);if(i)return i;if(e instanceof o["Material"])return this.set(e,e),e;t||(this.regBasicRes(e),await this.initBasicRes());let n,r={};if(e.params)for(let s of Object.getOwnPropertyNames(e.params))"map"===s||s.endsWith("Map")?r[s]=this.texMgr.get(e.params[s]):r[s]=e.params[s];if(e.matClass)n=new e.matClass(r);else{if(!e.init)throw"Error MatDesc: "+JSON.stringify(e);n=e.init(r)}return this.set(e,n),n}reg(e){e instanceof o["Material"]?this.set(e,e):super.reg(e)}}return e.instance=new e,e})();var le=ce;function ue(e,t,i,n=ve.instance,r=le.instance){return e.map(e=>de(e,t,i,n,r))}function de(e,t,i,n=ve.instance,r=le.instance){let s=n.get(e.model),a=e.mat&&r.get(e.mat),h=new o["Mesh"](s,i||a);return a&&(h.userData["_mat"]=a),t&&t.add(h),e.name&&(h.name=e.name),e.position&&h.position.set(...e.position),e.rotate&&h.rotation.set(...F(...e.rotate)),e.scale&&h.scale.set(...e.scale),e.children&&ue(e.children,h,i,n,r),h.castShadow=!0,h.receiveShadow=!0,h}function fe(e){return"Mesh"===e.type}function pe(e,t,i=!0){let n=t||new Map;return e.traverse(e=>{if(fe(e)&&(n.set(e.name,e.geometry),i&&e.material))if(Array.isArray(e.material))for(let t of e.material)t.dispose();else e.material.dispose()}),n}async function me(e,t){let i=t&&(e=>t(new D("GLTFLoading",e,e.loaded,e.total)));return new Promise((t,n)=>(new o["GLTFLoader"]).load(e,t,i,n))}function ge(e){return e.url}let we=(()=>{class e extends c{constructor(){super(...arguments),this.fileMgr=A.instance}regBasicRes(...e){let t=e.length?e:this.unready;for(let i of t)ge(i)&&this.fileMgr.reg(i.url)}async initBasicRes(){await this.fileMgr.init()}async make(e,t){if("string"===typeof e)return this.get(e);if(e instanceof o["Geometry"]||e instanceof o["BufferGeometry"])return this.set(e,e),e;if(!ge(e))return this.set(e.name,e.model),e.model;t||(this.regBasicRes(e),await this.initBasicRes());let i=this.fileMgr.getBlobUrl(e.url);if(!i)throw"Missed GLTF File: "+e.url;let n=await me(i);console.log(n),pe(n.scene,this)}reg(e){e instanceof o["Geometry"]||e instanceof o["BufferGeometry"]?this.set(e,e):super.reg(e)}}return e.instance=new e,e})();var ve=we;let ye=(()=>{class e{constructor(){this.rotateX=e.ranges.rotateX.initValue,this.rotateY=e.ranges.rotateY.initValue,this.zoom=e.ranges.zoom.initValue,this.center=new o["Vector3"](0,0,0),this.farRange=new ee(1,10)}get isInitValue(){return this.rotateX===e.ranges.rotateX.initValue&&this.rotateY===e.ranges.rotateY.initValue&&this.zoom===e.ranges.zoom.initValue}get cameraPosition(){let t=e.zoomToR(this.farRange,this.zoom),i=t*Math.sin(V(this.rotateX)),n=t*Math.cos(V(this.rotateX)),r=n*Math.sin(V(this.rotateY)),s=n*Math.cos(V(this.rotateY));return[r+this.center.x,i+this.center.y,s+this.center.z]}reset(){Object.assign(this,e.initValue)}static zoomToR(t,i){return t.lerp(1-Y(e.zoomRange.rlerp(i)))}static get initValue(){return{rotateX:e.ranges.rotateX.initValue,rotateY:e.ranges.rotateY.initValue,zoom:e.ranges.zoom.initValue}}}return e.zoomRange=new ee(1,10),e.ranges={rotateX:ie.create({min:-90,max:90,step:1,group:5,unit:"°",initValue:30}),rotateY:ie.create({min:-180,max:180,step:1,group:10,unit:"°",initValue:0}),zoom:ie.create({min:1,max:10,step:.1,group:10,unit:"x",initValue:1})},e})();var _e=ye;let be=(()=>{class e extends re{constructor(e){super(e),this.size=1,this.actions=[],this.center=new o["Vector3"](0,0,0),this.lights={easy:[new o["DirectionalLight"](void 0,.5),new o["DirectionalLight"](void 0,.5)],on:[new o["DirectionalLight"](void 0,.4),new o["PointLight"](void 0,.3),new o["DirectionalLight"](void 0,.2),new o["PointLight"](void 0,.1)],off:[]},this.basicLight=new o["HemisphereLight"](10871039,6968103,1),this.shadowLight=new o["DirectionalLight"](16777215,.2),this.groundMat=new o["ShadowMaterial"]({opacity:.5}),this.ground=new o["Mesh"](new o["CircleBufferGeometry"](1e3,6),this.groundMat),this._mat="origin",this._light="on",this._lightRadius=2,this.sceneType=a.model,this._initGround(),this._initLight()}get renderShadow(){return this.shadowLight.castShadow}set renderShadow(e){this.shadowLight.castShadow=e}get mat(){return this._mat}set mat(e){this._mat=e,this.updateMat()}updateMat(){if("origin"!==this._mat){let t="color"===this._mat?e.colorMat:e.normalMat;_(e=>{e instanceof o["Mesh"]&&(e.material=t)},this.children)}else _(t=>{t instanceof o["Mesh"]&&(t.material=t.userData["_mat"]||e.colorMat)},this.children);this.ground.material=this.groundMat}get light(){return this._light}set light(e){this.remove(...this.lights[this._light]),this._light=e,this._updateLights()}_orbitLights(e,t=33.7){let i=new _e;i.farRange.max=this.lightRadius,i.rotateX=30;let n=e.length;for(let r=0;r<n;r+=1)i.rotateY=t+360*r/n,e[r].position.set(...i.cameraPosition)}_updateEasyLights(){this._orbitLights(this.lights.easy)}_updateComplexLights(){this._orbitLights(this.lights.on)}_updateLights(){this.add(...this.lights[this._light]),"off"===this._light?this.basicLight.intensity=1.5:(this.basicLight.intensity=.8,"easy"===this._light?this._updateEasyLights():this._updateComplexLights())}get lightRadius(){return this._lightRadius}set lightRadius(e){this._lightRadius=e,this._updateLights()}_initLight(){this.basicLight.name="_basicLight",this.add(this.basicLight),this.shadowLight.name="_shadowLight",this.shadowLight.position.set(5,10,7.5),this.shadowLight.shadow.mapSize.set(2048,2048),this.shadowLight.castShadow=!0,this.add(this.shadowLight),this.lights.easy.forEach((e,t)=>e.name="_easyLight"+t),this.lights.on.forEach((e,t)=>e.name="_light"+t),this._updateLights()}_initGround(){this.ground.name="_ground",this.ground.rotation.set(V(-90),0,0),this.ground.receiveShadow=!0,this.add(this.ground)}static fromDesc(t,i=P.instance,n=ve.instance,r=le.instance,s=he.instance){let a=new e;a.setWithDesc(t,i);let h={origin:void 0,color:e.colorMat,normal:e.normalMat}[a.mat],{size:c,actions:l}=t;if(y(a,{size:c,actions:l}),t.center&&(a.center=new o["Vector3"](...t.center)),t.env&&(a.environment=s.get(t.env)||null),t.children){let e=new o["Group"];e.name="content",ue(t.children,e,h,n,r),a.add(e)}return t.shipBody&&(a.shipBody=de(t.shipBody,void 0,h,n,r)),a}}return e.normalMat=new o["MeshNormalMaterial"],e.colorMat=new o["MeshStandardMaterial"]({color:8898542,metalness:.2,roughness:.55}),e})();var Se=be,xe=(i("1ac3"),i("faa1"));class Me extends o["WebGLRenderer"]{constructor(e){super({antialias:!0,alpha:!0}),this._clearNowScene=this._setNowScene.bind(this),this._contextReady=!1,this._looper_binded=this._looper.bind(this),this._onResize_binded=this._onResize.bind(this),this._scenes=new Set([]),this._timerNewNowScene=0,this.events=new xe["EventEmitter"],this.funcs=[],this.hidden=!1,this.lastTime=0,this.running=!1,window.addEventListener("arjs-nft-loaded",e=>this.events.emit("nftLoaded")),this.setClearAlpha(0),this.domElement.classList.add("filled"),this._arSource=new THREEx.ArToolkitSource(e||{sourceType:"webcam"}),this._arSource.init(this._onResize_binded),window.addEventListener("resize",this._onResize_binded),this._arContext=new THREEx.ArToolkitContext({cameraParametersUrl:"https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.1.0/data/data/camera_para.dat",detectionMode:"mono"})}get nowScene(){return this._nowScene}async init(){if(!this._contextReady)return new Promise(e=>this._arContext.init(()=>{for(let e of this._scenes)this._sceneToContext(e,this._arContext);this.events.emit("contextReady"),this._contextReady=!0,e()}))}_firstActivedScene(){for(let e of this._scenes)if(e.camera.visible)return this.nowSceneActrual=e}_looper(e){if(this.running&&requestAnimationFrame(this._looper_binded),!this._arSource.ready)return;if(this.hidden)return this.clear();this._arContext.update(this._arSource.domElement),this.lastTime||(this.lastTime=e-1e3/60);let t=e-this.lastTime;for(let i of this.funcs)i(t,e);if(this.nowSceneActrual=this._firstActivedScene(),this._newNowScene(),this._nowScene){for(let i of this._nowScene.onTickFuncs)i(t,e,this._nowScene);this.render(this._nowScene,this._nowScene.camera)}this.lastTime=e}_newNowScene(){if(this.nowSceneActrual){if(this._timerNewNowScene&&clearTimeout(this._timerNewNowScene),this._timerNewNowScene=void 0,this._nowScene===this.nowSceneActrual)return;this._setNowScene(this.nowSceneActrual)}else void 0===this._timerNewNowScene&&(this._timerNewNowScene=setTimeout(this._clearNowScene,2e3))}_onResize(){this._arSource.onResizeElement(),this._arSource.copyElementSizeTo(this.domElement),this._arContext.arController&&this._arSource.copyElementSizeTo(this._arContext.arController.canvas)}_sceneToContext(e,t){if(e.marker)return e.camera.projectionMatrix.copy(t.getProjectionMatrix()),new THREEx.ArMarkerControls(t,e.camera,{type:"nft",descriptorsUrl:e.marker,changeMatrixMode:"cameraTransformMatrix",smoothCount:60,smoothTolerance:1,smoothThreshold:5,smooth:!0,size:.16})}_setNowScene(e){let t=this._nowScene;if(t&&(t.visible=!1),e&&(e.visible=!0,e instanceof Se)){let t=300/e.size,i=e.getObjectByName("content");i&&i.scale.set(t,t,t)}this._nowScene=e,this.clear(),this.events.emit("sceneChanged",e,t)}addScene(e){this._scenes.add(e),this._contextReady&&this._sceneToContext(e,this._arContext)}async loadScenes(e,t){if(!this._contextReady)throw"Need contextReady first!";let i=0,n=e.length;return new Promise(r=>{let s=()=>{t&&t(new D("ArRender.ArStarting",void 0,i+=1,n)),i===n&&(this.events.off("nftLoaded",s),r())};this.events.on("nftLoaded",s);for(let t of e)t.marker||s(),this.addScene(t)})}domTo(e){this.setSize(e.offsetWidth,e.offsetHeight),e.appendChild(this.domElement),setInterval(()=>this._onResize(),1e3)}hide(){this.hidden=!0,this.pause()}pause(){this.running=!1,this._timerNewNowScene&&(clearTimeout(this._timerNewNowScene),this._timerNewNowScene=void 0)}removeScene(e){this._scenes.delete(e)}start(){this.running||(this.hidden=!1,this.running=!0,requestAnimationFrame(this._looper_binded))}}var Le=Me;class Re extends re{constructor(e){super(e),this.videoUrl="",this.add(this.camera),this.sceneType=a.video}static fromDesc(e,t=P.instance,i=A.instance){let n=new Re;n.setWithDesc(e,t);let r=i.getBlobUrl(e.videoUrl);if(!r)throw"Can't find video: "+r;return n.videoUrl=r,n}}var Ee=Re;let Te=(()=>{class e extends c{constructor(){super(...arguments),this.markerMgr=P.instance,this.modelMgr=ve.instance,this.matMgr=le.instance,this.fileMgr=A.instance}static descIsName(e){return"string"===typeof e}static descIsModel(t){return!e.descIsName(t)&&t.sceneType===a.model}static descIsVideo(t){return!e.descIsName(t)&&t.sceneType===a.video}static descIsExp(t){return!e.descIsName(t)&&t.sceneType===a.exp}static descIsNone(t){return!e.descIsName(t)&&t.sceneType===a.none}async _makeScene(e,t,i=re.fromDesc){t||(this.regBasicRes(e),await this.initBasicRes());let n=i(e);return this.set(n.name,n),n}async make(t,i){if(e.descIsName(t))return this.get(t);let n=this.get(t.sceneID);return n||(e.descIsModel(t)?this._makeScene(t,i,Se.fromDesc):e.descIsVideo(t)?this._makeScene(t,i,Ee.fromDesc):e.descIsExp(t)?this._makeScene(t,i,oe.fromDesc):this._makeScene(t,i))}regBasicRes_basic(e){e.markerUrl&&this.markerMgr.reg(e.markerUrl)}regBasicRes_model(e){this.regBasicRes_basic(e),e.children&&_(e=>{this.modelMgr.reg(e.model),e.mat&&this.matMgr.reg(e.mat)},e.children,e)}regBasicRes_video(e){this.regBasicRes_basic(e),e.videoUrl&&this.fileMgr.reg(e.videoUrl)}regBasicRes_exp(e){this.regBasicRes_basic(e)}regBasicRes(...t){let i=t.length?t:this.unready;for(let n of i)e.descIsName(n)||(e.descIsModel(n)?this.regBasicRes_model(n):e.descIsVideo(n)?this.regBasicRes_video(n):e.descIsExp(n)&&this.regBasicRes_exp(n))}async initBasicRes(){await this.markerMgr.init(),await this.modelMgr.init(),await this.matMgr.init(),await this.fileMgr.init()}reg(t){e.descIsName(t)||super.reg(t)}}return e.instance=new e,e})();var Ce=Te;let De=(()=>{class e{static get cacheLoaded(){return e._cacheLoaded}static get loaded(){return void 0!==e._arRender}static get render(){return e._arRender}static get resLoaded(){return e._resLoaded}static async loadCacheFromDB(e){let t=new f;for await(let[{name:i},n]of e.items("caches"))t.addData(n.toString(),i);return t}static emit(t,i=0,n=1,r){e.processCB&&e.processCB(new D(t,r,i,n))}static emitError(t,i){e.processCB&&e.processCB(new D(t,i,0,1,!1))}static async updateCache(){if(e._cacheLoaded)return;let t;await e.fs.init(),e.emit("Loader.IndexGetting",1,2);try{t=await e.loadIndex(B.resServer+"/index.txt")}catch(n){e.emitError("Loader.IndexFetchError",n);let{versionName:t}=e.fs;if(t)return e.emit("Loader.IndexLocal",1,1,{versionName:t});throw e.emitError("Loader.IndexNone"),"Init Caches Failed!"}e.emit("Loader.IndexDiffsCalcing",2,2),await e.fs.mergeTo(t,e.processCB);let{versionName:i}=e.fs;e.emit("Loader.IndexNewest",1,1,{versionName:i}),e._cacheLoaded=!0}static async loadScenes(t){if(e._resLoaded)return;e.emit("Loader.ScenesReging");for(let n of e.fs.find(/models\//))e.models.reg({url:n});for(let e of t)Ce.instance.reg(e);e.emit("Loader.ScenesReged",1);let i=async(t,i)=>{t.processCB=(t,n)=>e.emit(i,t,n),await t.init(),delete t.processCB};await i(e.models,"Loader.ModelsLoading"),await i(e.scenes,"Loader.ScenesLoading"),e.emit("Loader.ScenesLoaded",1),e._resLoaded=!0}static async initAR(t,i){if(e._arRender)return e._arRender;e.emit("Loader.ArIniting");let n=new Le(i);return n.domTo(t),await n.init(),e.emit("Loader.ArInited",1),e._arRender=n}static async startAR(){if(!e._arRender)throw"Need initAR(dom) first!";let t=e._arRender;if(!e._resLoaded)throw"Need loadResource(url) first!";await t.loadScenes(Array.from(e.scenes.values()),e.processCB),t.start(),e.emit("Loader.ArStarted",1)}}return e.fs=B.instance,e.models=ve.instance,e.scenes=Ce.instance,e._cacheLoaded=!1,e._resLoaded=!1,e.loadIndex=async(e,t)=>new f(await(await fetch(e,t)).text()),e.loadCache=e.fs.cachedIndex,e})();var Oe=De;class Be extends o["WebGLRenderer"]{constructor(){super({antialias:!0,alpha:!0}),this._arScene=null,this._looper_binded=this._looper.bind(this),this.funcs=[],this.running=!1,this.hidden=!1,this.lastTime=0,this.camera=new o["PerspectiveCamera"],this._initRender(),this._initDom()}_initRender(){this.setClearAlpha(0),this.setPixelRatio(window.devicePixelRatio),this.shadowMap.enabled=!0,this.shadowMap.type=o["PCFSoftShadowMap"]}_initDom(){this.domElement.classList.add("filled");let e=()=>this._onResize();window.addEventListener("resize",e)}_looper(e){if(this.running&&requestAnimationFrame(this._looper_binded),this.hidden)return this.clear();this.lastTime||(this.lastTime=e-1e3/60);let t=e-this.lastTime;for(let i of this.funcs)i(t,e);if(this._arScene){for(let i of this._arScene.onTickFuncs)i(t,e,this._arScene);this.render(this._arScene,this.camera)}this.lastTime=e}_onResize(){if(!this.domElement.parentElement)return;let e=this.domElement.parentElement.offsetWidth,t=this.domElement.parentElement.offsetHeight;this.setSize(e,t),this.resetCamera()}resetCamera(){let e=this.domElement.offsetWidth,t=this.domElement.offsetHeight;this.camera.aspect=e/t,this.camera.fov=70,this.camera.updateProjectionMatrix()}start(){this.running||(this.hidden=!1,this.running=!0,requestAnimationFrame(this._looper_binded))}pause(){this.running=!1}hide(){this.hidden=!0,this.pause()}domTo(e){this.setSize(e.offsetWidth,e.offsetHeight),e.appendChild(this.domElement),setInterval(()=>this._onResize(),2e3)}get arScene(){return this._arScene}set arScene(e){if(this._arScene&&(this._arScene.visible=!1),e){e.visible=!0;let t=4/e.size,i=e.getObjectByName("content");i&&i.scale.set(t,t,t)}this._arScene=e,this.resetCamera()}}var Ne=Be;class Ae extends _e{constructor(){super(...arguments),this.nowState="none",this.startX=0,this.startY=0,this.startDist=0,this.startValue=new _e,this.wheelScroll_binded=this.wheelScroll.bind(this),this.touchStart_binded=this.touchStart.bind(this),this.touchMove_binded=this.touchMove.bind(this),this.touchEnd_binded=this.touchEnd.bind(this)}updateState(e){let t=!1,i=e.srcElement;e instanceof PointerEvent&&i.setPointerCapture(e.pointerId);let n=e instanceof TouchEvent?e.touches:[e];return 1===n.length&&"rotate"!==this.nowState&&(t=!0,this.nowState="rotate"),n.length>1&&"zoom"!==this.nowState&&(t=!0,this.nowState="zoom"),t&&(i.addEventListener("touchmove",this.touchMove_binded),i.addEventListener("pointermove",this.touchMove_binded),i.addEventListener("touchend",this.touchEnd_binded),i.addEventListener("pointerup",this.touchEnd_binded),this.startX=n[0].clientX,this.startY=n[0].clientY,this.startDist=Ae.calcFingerDist(e),this.startValue.rotateX=this.rotateX,this.startValue.rotateY=this.rotateY,this.startValue.zoom=this.zoom),t}listenOn(e){e.addEventListener("touchstart",this.touchStart_binded),e.addEventListener("pointerdown",this.touchStart_binded),e.addEventListener("wheel",this.wheelScroll_binded)}unlistenOn(e){e.removeEventListener("touchstart",this.touchStart_binded),e.removeEventListener("pointerdown",this.touchStart_binded),e.removeEventListener("wheel",this.wheelScroll_binded)}wheelScroll(e){this.zoom=_e.ranges.zoom.fixValue(this.zoom-e.deltaY/200)}touchStart(e,t=!1){t||e.preventDefault(),this.updateState(e)}touchMove(e,t=!1){t||e.preventDefault(),this.updateState(e);let i=e instanceof TouchEvent?e.touches:[e];"rotate"===this.nowState?(this.rotateY=_e.ranges.rotateY.fixValue(this.startValue.rotateY-i[0].clientX+this.startX),this.rotateX=_e.ranges.rotateX.fixValue(this.startValue.rotateX+i[0].clientY-this.startY)):this.zoom=_e.ranges.zoom.fixValue(this.startValue.zoom+(Ae.calcFingerDist(e)-this.startDist)/50)}touchEnd(e,t=!1){t||e.preventDefault();let i=e.srcElement;e instanceof PointerEvent&&i.releasePointerCapture(e.pointerId),i.removeEventListener("touchmove",this.touchMove_binded),i.removeEventListener("pointermove",this.touchMove_binded),i.removeEventListener("touchend",this.touchEnd_binded),i.removeEventListener("pointerup",this.touchEnd_binded),this.nowState="none"}static calcFingerDist(e){if(e instanceof MouseEvent||e.touches.length<2)return 0;let t=e.touches[1].clientX-e.touches[0].clientX,i=e.touches[1].clientY-e.touches[0].clientY;return Math.sqrt(t*t+i*i)}}var Ie=Ae,Pe=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{ref:"model-render",staticClass:"model-render"})},je=[];function ke(e,t,i,n){var r,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(o=(s<3?r(o):s>3?r(t,i,o):r(t,i))||o);return s>3&&o&&Object.defineProperty(t,i,o),o}
/**
  * vue-class-component v7.2.3
  * (c) 2015-present Evan You
  * @license MIT
  */
function Ve(e){return Ve="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ve(e)}function Fe(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function ze(e){return Ue(e)||He(e)||qe()}function Ue(e){if(Array.isArray(e)){for(var t=0,i=new Array(e.length);t<e.length;t++)i[t]=e[t];return i}}function He(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function qe(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function Ye(){return"undefined"!==typeof Reflect&&Reflect.defineMetadata&&Reflect.getOwnMetadataKeys}function Xe(e,t){$e(e,t),Object.getOwnPropertyNames(t.prototype).forEach((function(i){$e(e.prototype,t.prototype,i)})),Object.getOwnPropertyNames(t).forEach((function(i){$e(e,t,i)}))}function $e(e,t,i){var n=i?Reflect.getOwnMetadataKeys(t,i):Reflect.getOwnMetadataKeys(t);n.forEach((function(n){var r=i?Reflect.getOwnMetadata(n,t,i):Reflect.getOwnMetadata(n,t);i?Reflect.defineMetadata(n,r,e,i):Reflect.defineMetadata(n,r,e)}))}var Ge={__proto__:[]},We=Ge instanceof Array;function Ke(e){return function(t,i,n){var r="function"===typeof t?t:t.constructor;r.__decorators__||(r.__decorators__=[]),"number"!==typeof n&&(n=void 0),r.__decorators__.push((function(t){return e(t,i,n)}))}}function Je(e){var t=Ve(e);return null==e||"object"!==t&&"function"!==t}function Ze(e,t){var i=t.prototype._init;t.prototype._init=function(){var t=this,i=Object.getOwnPropertyNames(e);if(e.$options.props)for(var n in e.$options.props)e.hasOwnProperty(n)||i.push(n);i.forEach((function(i){"_"!==i.charAt(0)&&Object.defineProperty(t,i,{get:function(){return e[i]},set:function(t){e[i]=t},configurable:!0})}))};var n=new t;t.prototype._init=i;var r={};return Object.keys(n).forEach((function(e){void 0!==n[e]&&(r[e]=n[e])})),r}var Qe=["data","beforeCreate","created","beforeMount","mounted","beforeDestroy","destroyed","beforeUpdate","updated","activated","deactivated","render","errorCaptured","serverPrefetch"];function et(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.name=t.name||e._componentTag||e.name;var i=e.prototype;Object.getOwnPropertyNames(i).forEach((function(e){if("constructor"!==e)if(Qe.indexOf(e)>-1)t[e]=i[e];else{var n=Object.getOwnPropertyDescriptor(i,e);void 0!==n.value?"function"===typeof n.value?(t.methods||(t.methods={}))[e]=n.value:(t.mixins||(t.mixins=[])).push({data:function(){return Fe({},e,n.value)}}):(n.get||n.set)&&((t.computed||(t.computed={}))[e]={get:n.get,set:n.set})}})),(t.mixins||(t.mixins=[])).push({data:function(){return Ze(this,e)}});var n=e.__decorators__;n&&(n.forEach((function(e){return e(t)})),delete e.__decorators__);var r=Object.getPrototypeOf(e.prototype),s=r instanceof k.a?r.constructor:k.a,o=s.extend(t);return it(o,e,s),Ye()&&Xe(o,e),o}var tt={prototype:!0,arguments:!0,callee:!0,caller:!0};function it(e,t,i){Object.getOwnPropertyNames(t).forEach((function(n){if(!tt[n]){var r=Object.getOwnPropertyDescriptor(e,n);if(!r||r.configurable){var s=Object.getOwnPropertyDescriptor(t,n);if(!We){if("cid"===n)return;var o=Object.getOwnPropertyDescriptor(i,n);if(!Je(s.value)&&o&&o.value===s.value)return}0,Object.defineProperty(e,n,s)}}}))}function nt(e){return"function"===typeof e?et(e):function(t){return et(t,e)}}nt.registerHooks=function(e){Qe.push.apply(Qe,ze(e))};var rt=nt;var st="undefined"!==typeof Reflect&&"undefined"!==typeof Reflect.getMetadata;function ot(e,t,i){if(st&&!Array.isArray(e)&&"function"!==typeof e&&"undefined"===typeof e.type){var n=Reflect.getMetadata("design:type",t,i);n!==Object&&(e.type=n)}}function at(e){return void 0===e&&(e={}),function(t,i){ot(e,t,i),Ke((function(t,i){(t.props||(t.props={}))[i]=e}))(t,i)}}function ht(e,t){void 0===t&&(t={});var i=t.deep,n=void 0!==i&&i,r=t.immediate,s=void 0!==r&&r;return Ke((function(t,i){"object"!==typeof t.watch&&(t.watch=Object.create(null));var r=t.watch;"object"!==typeof r[e]||Array.isArray(r[e])?"undefined"===typeof r[e]&&(r[e]=[]):r[e]=[r[e]],r[e].push({handler:i,deep:n,immediate:s})}))}let ct=(()=>{let e=class extends k.a{constructor(){super(...arguments),this.viewController=new Ie}mounted(){this.modelRender=new Ne;let e=this.$refs["model-render"];this.modelRender.domTo(e),this.orbitViewChanged(),this.cameraPosChange(this.viewController.cameraPosition),this.modelRender.start()}beforeDestroy(){this.modelRender.pause()}useScene(e){this.nowScene=e,this.modelRender.arScene=e,this.viewController.center=e.center,this.lightChanged(),this.matChanged()}lightChanged(){this.nowScene&&(this.nowScene.light=this.light)}matChanged(){this.nowScene&&(this.nowScene.mat=this.mat)}shadowChanged(){this.nowScene&&(this.nowScene.renderShadow=this.shadow)}orbitViewChanged(){let e=this.$refs["model-render"];this.orbitView?this.viewController.listenOn(e):this.viewController.unlistenOn(e)}cameraPosChange(e){this.modelRender.camera.position.set(...e),this.modelRender.camera.lookAt(0,0,0)}};return ke([at({default:!0})],e.prototype,"orbitView",void 0),ke([at({default:"on"})],e.prototype,"light",void 0),ke([at({default:"origin"})],e.prototype,"mat",void 0),ke([at({default:!0})],e.prototype,"shadow",void 0),ke([ht("light")],e.prototype,"lightChanged",null),ke([ht("mat")],e.prototype,"matChanged",null),ke([ht("shadow")],e.prototype,"shadowChanged",null),ke([ht("orbitView")],e.prototype,"orbitViewChanged",null),ke([ht("viewController.cameraPosition")],e.prototype,"cameraPosChange",null),e=ke([rt],e),e})();var lt=ct,ut=lt;function dt(e,t,i,n,r,s,o,a){var h,c="function"===typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=i,c._compiled=!0),n&&(c.functional=!0),s&&(c._scopeId="data-v-"+s),o?(h=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},c._ssrRegister=h):r&&(h=a?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),h)if(c.functional){c._injectStyles=h;var l=c.render;c.render=function(e,t){return h.call(t),l(e,t)}}else{var u=c.beforeCreate;c.beforeCreate=u?[].concat(u,h):[h]}return{exports:e,options:c}}var ft=dt(ut,Pe,je,!1,null,null,null),pt=ft.exports;async function mt(e,...t){try{return await e(...t)}catch(i){}}async function gt(e){return new Promise(t=>setTimeout(t,e))}function wt(e,t=0,i=""){return e.map(e=>e.toString().padStart(t,"0")).join(i)}function vt(e,t=""){return e||(e=new Date),wt([e.getFullYear(),e.getMonth()+1,e.getDate()],2,t)}function yt(e,t=""){return e||(e=new Date),wt([e.getHours(),e.getMinutes(),e.getSeconds()],2,t)}}})}));
//# sourceMappingURL=cbkzxtArBasic.umd.min.js.map